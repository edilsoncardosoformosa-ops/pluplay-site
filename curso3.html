<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mapas Mentais</title>
<style>
:root{--p:#1E90FF;--s:#FFA500;--bg:#f4f4f9;--fg:#333}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--fg)}
header{background:var(--p);color:#fff;padding:12px 20px;text-align:center}
header h1{margin:0;font-size:1.8em}
main{padding:20px;max-width:800px;margin:0 auto}
.card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin-bottom:16px}
button{cursor:pointer;border:0;border-radius:8px;padding:8px 12px;background:var(--p);color:#fff;margin-top:8px}
input{width:100%;padding:8px;margin-top:8px;border-radius:6px;border:1px solid #ddd}
ul{list-style:none;padding:0}
li{padding:6px 0;display:flex;justify-content:space-between;align-items:center}
a.download{color:var(--p);text-decoration:none;margin-left:10px}
</style>
</head>
<body>
<header><h1>Compartilhe Mapas Mentais</h1></header>
<main>
<div class="card">
<h3>Enviar arquivo (PDF/JPG/JPEG)</h3>
<input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg">
<button id="uploadBtn">Enviar</button>
<p id="status"></p>
</div>
<div class="card">
<h3>Arquivos disponíveis</h3>
<ul id="fileList"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// Inicialização do Supabase
const SUPABASE_URL="https://nqhthypeljupfftlmwsz.supabase.co";
const SUPABASE_KEY="sb_publishable_Nzfhcwd_mFYlzJro3318-g_aX6vGjD1";
const supabaseClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

const fileInput=document.getElementById('fileInput');
const uploadBtn=document.getElementById('uploadBtn');
const status=document.getElementById('status');
const fileList=document.getElementById('fileList');

async function listFiles(){
  fileList.innerHTML='';
  const { data, error } = await supabaseClient.storage.from('mapas').list('mapas');
  if(error){console.error(error);return;}
  data.forEach(f=>{
    const li=document.createElement('li');
    li.textContent=f.name;
    const a=document.createElement('a');
    a.href=`https://nqhthypeljupfftlmwsz.supabase.co/storage/v1/object/public/mapas/mapas/${encodeURIComponent(f.name)}`;
    a.target='_blank';
    a.textContent='Baixar';
    a.className='download';
    li.appendChild(a);
    fileList.appendChild(li);
  });
}

uploadBtn.addEventListener('click',async()=>{
  const file=fileInput.files[0];
  if(!file){alert('Selecione um arquivo');return;}
  const ext=file.name.split('.').pop().toLowerCase();
  if(!['pdf','jpg','jpeg'].includes(ext)){alert('Tipo inválido');return;}
  const { data, error } = await supabaseClient.storage.from('mapas').upload(`mapas/${file.name}`, file, {upsert:true});
  if(error){status.textContent='Erro: '+error.message;console.error(error);}
  else{status.textContent='Arquivo enviado com sucesso';listFiles();fileInput.value='';}
});

// Inicializa lista
listFiles();
</script>
</main>
</body>
</html>
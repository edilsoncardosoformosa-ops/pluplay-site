<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Compartilhar Mapas Mentais</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background:#f4f4f9; color:#333; }
h1 { color:#1E90FF; }
form { background:#fff; padding:20px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.1); max-width:400px; }
input[type=file], input[type=text] { width:100%; padding:8px; margin-bottom:12px; border:1px solid #ccc; border-radius:5px; }
button { background:#1E90FF; color:#fff; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; }
button:disabled { background:#999; cursor:not-allowed; }
.message { margin-top:10px; }
</style>
</head>
<body>
<h1>Compartilhe seu Mapa Mental</h1>
<form id="mapForm">
<label>Nome do mapa:</label>
<input type="text" id="mapName" placeholder="Ex: História do Brasil" required>
<label>Escolha o arquivo (.pdf, .jpg, .jpeg, até 10MB):</label>
<input type="file" id="mapFile" accept=".pdf,.jpg,.jpeg" required>
<button type="submit">Enviar</button>
<div class="message" id="msg"></div>
</form>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = 'https://nqhthypeljupfftlmwsz.supabase.co';
const SUPABASE_KEY = 'sb_publishable_Nzfhcwd_mFYlzJro3318-g_aX6vGjD1';
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

document.getElementById('mapForm').addEventListener('submit', async e => {
  e.preventDefault();
  const name = document.getElementById('mapName').value.trim();
  const fileInput = document.getElementById('mapFile');
  const file = fileInput.files[0];
  const msg = document.getElementById('msg');
  msg.textContent = '';

  if (!file) return msg.textContent = 'Selecione um arquivo!';
  if (!['application/pdf','image/jpeg'].includes(file.type)) return msg.textContent = 'Formato inválido!';
  if (file.size > 10 * 1024 * 1024) return msg.textContent = 'Arquivo maior que 10 MB!';

  try {
    const filePath = `${Date.now()}_${file.name}`;
    const { data, error } = await supabase.storage.from('mapas').upload(filePath, file, { upsert: true });
    if (error) throw error;

    msg.textContent = 'Upload realizado com sucesso!';
    fileInput.value = '';
    document.getElementById('mapName').value = '';
  } catch (err) {
    console.error(err);
    msg.textContent = 'Erro ao enviar o arquivo.';
  }
});
</script>
</body>
</html>
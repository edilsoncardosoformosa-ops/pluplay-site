// ============================ // controle.js - Supabase // ============================ // ConfiguraÃ§Ã£o Supabase const SUPABASE_URL = 'https://nqhthypeljupfftlmwsz.supabase.co'; const SUPABASE_KEY = 'esb_publishable_Nzfhcwd_mFYlzJro3318-g_aX6vGjD1'; // sua chave pÃºblica const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY); // ============================ // InicializaÃ§Ã£o do usuÃ¡rio // ============================ let userType = localStorage.getItem('userType') || 'demo'; let userId = localStorage.getItem('userId') || crypto.randomUUID(); localStorage.setItem('userId', userId); document.getElementById('userIdBox').value = userId; document.getElementById('waLink').href = 'https://wa.me/5561999251102?text=Meu%20ID:%20'+encodeURIComponent(userId); document.getElementById('copyIdBtn').addEventListener('click', () => { const uid = document.getElementById('userIdBox').value; if(navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(uid).then(()=>alert('ID copiado!')).catch(()=>fallbackCopy(uid)); } else fallbackCopy(uid); }); function fallbackCopy(text){ const ta = document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); try{document.execCommand('copy')?alert('ID copiado!'):alert('NÃ£o foi possÃ­vel copiar.');} catch(e){alert('Erro ao copiar. Copie manualmente.');} document.body.removeChild(ta); } // ============================ // Mostrar conteÃºdo protegido // ============================ if(userType!=='master'){ document.getElementById('protectedContent').classList.remove('hidden'); document.getElementById('userInfo').classList.remove('hidden'); if(userType==='demo') document.getElementById('demoNote').classList.remove('hidden'); } // ============================ // Voz // ============================ let voiceEnabled = false; document.getElementById('toggleVoice').onclick = ()=>{ voiceEnabled = !voiceEnabled; document.getElementById('toggleVoice').classList.toggle('active', voiceEnabled); document.getElementById('toggleVoice').innerText = voiceEnabled ? 'ðŸ—£ Desativar Ler' : 'ðŸ—£ Ativar Ler'; }; // ============================ // Senha manual // ============================ document.getElementById('btnManualPassword').onclick = async ()=>{ const pw = prompt("Digite a senha de liberaÃ§Ã£o:"); if(!pw) return; // Buscar senha master no Supabase let { data, error } = await supabase.from('users').select('note').eq('id', 'MASTER'); if(error){ alert('Erro ao verificar senha.'); return; } if(data && data[0] && data[0].note === pw){ alert("Senha correta! Acesso liberado."); userType = 'aluno'; localStorage.setItem('userType','aluno'); } else { alert("Senha invÃ¡lida. Solicite ao Master a senha correta."); } }; // ============================ // Quiz // ============================ let quizCurrent=[], currentIndex=0, score=0; const maxDemo = 5; let answeredThis=false; // FunÃ§Ã£o para buscar questÃµes do Supabase async function fetchQuiz(topic){ let { data, error } = await supabase.from('questions').select('*').eq('topic', topic); if(error){ alert('Erro ao carregar questÃµes: '+error.message); return []; } return data.map(q => ({ q: q.question, a: q.answer, c: q.comment || '' })); } function shuffleArray(arr){ return arr.sort(()=>Math.random()-0.5); } async function startQuiz(topic){ let numQ = parseInt(document.getElementById('numQuestions').value) || 10; quizCurrent = await fetchQuiz(topic); if(userType==='demo') quizCurrent = quizCurrent.slice(0,maxDemo); quizCurrent = shuffleArray(quizCurrent).slice(0,numQ); currentIndex = 0; score = 0; document.getElementById('menu').classList.add('hidden'); document.getElementById('quiz').classList.remove('hidden'); document.getElementById('result').classList.add('hidden'); showQuestion(); } function showQuestion(){ if(currentIndex >= quizCurrent.length){ endQuiz(); return; } const q = quizCurrent[currentIndex]; document.getElementById('question').innerText = q.q; const commentBox = document.getElementById('comment'); commentBox.innerHTML=''; commentBox.style.opacity=0; document.getElementById('counter').innerText = QuestÃ£o ${currentIndex+1} de ${quizCurrent.length}; answeredThis = false; if(voiceEnabled){ let u = new SpeechSynthesisUtterance(q.q); u.lang='pt-BR'; u.rate=1.5; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); } } function answer(val){ if(answeredThis) return; answeredThis = true; const q = quizCurrent[currentIndex]; const commentBox = document.getElementById('comment'); if(q.a === val){ score++; commentBox.innerHTML = <div class="correct">âœ” VocÃª acertou! ${q.c}</div>; } else { commentBox.innerHTML = <div class="wrong">âœ– VocÃª errou! ${q.c}</div>; } commentBox.style.opacity = 1; if(voiceEnabled){ let u = new SpeechSynthesisUtterance((q.a===val?'VocÃª acertou! ':'VocÃª errou! ') + q.c); u.lang='pt-BR'; u.rate=1.5; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); } } function nextQuestion(){ currentIndex++; showQuestion(); } function backToMenu(){ document.getElementById('quiz').classList.add('hidden'); document.getElementById('result').classList.add('hidden'); document.getElementById('menu').classList.remove('hidden'); } function endQuiz(){ document.getElementById('quiz').classList.add('hidden'); document.getElementById('result').classList.remove('hidden'); document.getElementById('score').innerText = VocÃª acertou ${score} de ${quizCurrent.length} questÃµes.; } function restartQuiz(){ currentIndex=0; score=0; document.getElementById('result').classList.add('hidden'); document.getElementById('menu').classList.remove('hidden'); }
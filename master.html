<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Master Admin</title><style>body{font-family:Arial,sans-serif;background:#f4f4f9;margin:0;padding:0;color:#333}header{background:#1E90FF;color:#fff;padding:15px;text-align:center;font-size:20px;font-weight:bold}main{padding:20px}section{margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1)}h2{margin-top:0;color:#1E90FF;font-size:18px}label{display:block;margin:8px 0 4px}input,select,textarea{width:100%;padding:8px;margin-bottom:10px;border:1px solid #ccc;border-radius:5px}button{background:#1E90FF;color:#fff;border:none;padding:10px 15px;border-radius:5px;cursor:pointer;margin-right:5px}button:hover{background:#0056b3}.hidden{display:none}.list-item{border-bottom:1px solid #eee;padding:8px 0;display:flex;justify-content:space-between;align-items:center}.filters{margin-bottom:10px}</style></head><body><header>Painel Master</header><main>
<section id="addUser"><h2>Adicionar Usuário</h2><label>Nome:</label><input type="text" id="userName"><label>Email:</label><input type="email" id="userEmail"><label>Tipo:</label><select id="userType"><option value="demo">Demo</option><option value="admin">Admin</option><option value="aluno">Aluno</option><option value="professor">Professor</option></select><button onclick="addUser()">Salvar</button></section>
<section id="manageUsers"><h2>Gerenciar Usuários</h2><div id="usersList"></div></section>
<section id="addQuestion"><h2>Adicionar Questão</h2><label>Pergunta:</label><textarea id="questionText"></textarea><label>Resposta Correta (true/false):</label><select id="questionAnswer"><option value="true">Verdadeiro</option><option value="false">Falso</option></select><label>Comentário:</label><textarea id="questionComment"></textarea><label>Tópico:</label><input type="text" id="questionTopic"><button onclick="addQuestion()">Salvar</button></section>
<section id="manageQuestions"><h2>Gerenciar Questões</h2><div class="filters"><label>Filtrar por tópico:</label><input type="text" id="filterTopic" oninput="filterQuestions()"></div><div id="questionsList"></div></section>
<section id="addBlock"><h2>Adicionar Bloco</h2><label>JSON de Questões:</label><textarea id="blockJson" placeholder='[{ "q":"texto", "a":true, "c":"comentário" }]'></textarea><button onclick="addBlock()">Salvar</button></section>
</main><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script>
const supabaseUrl="https://nqhthypeljupfftlmwsz.supabase.co";
const supabaseKey="sb_publishable_Nzfhcwd_mFYlzJro3318-g_aX6vGjD1";
const supabaseClient=supabase.createClient(supabaseUrl,supabaseKey);

async function addUser(){
 let name=document.getElementById("userName").value.trim();
 let email=document.getElementById("userEmail").value.trim();
 let type=document.getElementById("userType").value;
 if(!name||!email){alert("Preencha todos os campos");return}
 let{error}=await supabaseClient.from("usuarios").insert([{nome:name,email:email,tipo:type}]);
 if(error){alert("Erro: "+error.message)}else{alert("Usuário adicionado");loadUsers()}
}
async function loadUsers(){
 let{data,error}=await supabaseClient.from("usuarios").select("*");
 if(error){console.error(error);return}
 let list=document.getElementById("usersList");list.innerHTML="";
 data.forEach(u=>{
  let div=document.createElement("div");div.className="list-item";
  div.innerHTML=`${u.nome} (${u.tipo}) <button onclick="deleteUser(${u.id})">Excluir</button>`;
  list.appendChild(div);
 })
}
async function deleteUser(id){
 if(!confirm("Excluir usuário?"))return;
 let{error}=await supabaseClient.from("usuarios").delete().eq("id",id);
 if(error){alert("Erro: "+error.message)}else{loadUsers()}
}

async function addQuestion(){
 let q=document.getElementById("questionText").value.trim();
 let a=document.getElementById("questionAnswer").value==="true";
 let c=document.getElementById("questionComment").value.trim();
 let t=document.getElementById("questionTopic").value.trim();
 if(!q||!c||!t){alert("Preencha todos os campos");return}
 let{data:exists}=await supabaseClient.from("questoes").select("id").eq("q",q);
 if(exists&&exists.length>0){alert("Questão já existe");return}
 let{error}=await supabaseClient.from("questoes").insert([{q:q,a:a,c:c,topic:t}]);
 if(error){alert("Erro: "+error.message)}else{alert("Questão adicionada");loadQuestions()}
}
async function loadQuestions(){
 let{data,error}=await supabaseClient.from("questoes").select("*");
 if(error){console.error(error);return}
 window.allQuestions=data;
 renderQuestions(data);
}
function renderQuestions(data){
 let list=document.getElementById("questionsList");list.innerHTML="";
 data.forEach(q=>{
  let div=document.createElement("div");div.className="list-item";
  div.innerHTML=`${q.q} [${q.topic}] <span><button onclick="editQuestion(${q.id})">Editar</button><button onclick="deleteQuestion(${q.id})">Excluir</button></span>`;
  list.appendChild(div);
 })
}
function filterQuestions(){
 let topic=document.getElementById("filterTopic").value.trim().toLowerCase();
 if(!topic){renderQuestions(window.allQuestions);return}
 let filtered=window.allQuestions.filter(q=>q.topic&&q.topic.toLowerCase().includes(topic));
 renderQuestions(filtered);
}
async function deleteQuestion(id){
 if(!confirm("Excluir questão?"))return;
 let{error}=await supabaseClient.from("questoes").delete().eq("id",id);
 if(error){alert("Erro: "+error.message)}else{loadQuestions()}
}
async function editQuestion(id){
 let novo=prompt("Edite a questão:");
 if(!novo)return;
 let{error}=await supabaseClient.from("questoes").update({q:novo}).eq("id",id);
 if(error){alert("Erro: "+error.message)}else{loadQuestions()}
}

async function addBlock(){
 let raw=document.getElementById("blockJson").value.trim();
 if(!raw){alert("Cole o JSON");return}
 let arr;try{arr=JSON.parse(raw)}catch(e){alert("Formato inválido JSON");return}
 for(let q of arr){
  let{data:exists}=await supabaseClient.from("questoes").select("id").eq("q",q.q);
  if(exists&&exists.length>0){console.log("Questão duplicada ignorada:",q.q);continue}
  await supabaseClient.from("questoes").insert([{q:q.q,a:q.a,c:q.c,topic:q.topic||"geral"}]);
 }
 alert("Bloco processado");loadQuestions();
}

window.onload=function(){loadUsers();loadQuestions()}
</script></body></html>
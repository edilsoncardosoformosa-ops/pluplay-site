<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Master Admin</title><style>body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f4f4f9;color:#333}header{background:#1E90FF;color:#fff;padding:10px;text-align:center;cursor:pointer}nav{display:flex;justify-content:center;background:#FFA500;padding:10px}nav button{margin:0 5px;padding:10px;border:none;border-radius:8px;background:#1E90FF;color:#fff;cursor:pointer}nav button:hover{background:#104E8B}section{display:none;padding:20px}section.active{display:block}table{width:100%;border-collapse:collapse;margin-top:10px}th,td{border:1px solid #ccc;padding:8px;text-align:left}th{background:#eee}#demoBanner{background:red;color:#fff;text-align:center;padding:5px}</style><script src="https://unpkg.com/@supabase/supabase-js"></script></head><body><header ondblclick="toggleNav()">Painel Master</header><div id="demoBanner">Modo demo: até 5 questões</div><nav id="mainNav" style="display:none"><button onclick="showTab('questions')">Gerenciar Questões</button><button onclick="showTab('blocks')">Adicionar Blocos</button><button onclick="showTab('users')">Gerenciar Usuários</button><button onclick="showTab('addq')">Adicionar Questão</button></nav><section id="questions"><h2>Questões</h2><select id="filterTopics"></select><div id="questionsList"></div></section><section id="blocks"><h2>Adicionar Blocos</h2><textarea id="blockJson" rows="6" style="width:100%"></textarea><button onclick="addBlock()">Salvar Bloco</button></section><section id="users"><h2>Gerenciar Usuários</h2><button onclick="addUserPrompt()">Adicionar Novo Usuário</button><div id="usersList"></div></section><section id="addq"><h2>Adicionar Questão</h2><input id="qText" placeholder="Enunciado" style="width:100%"><br><br><select id="qCorrect"><option value="true">Correta</option><option value="false">Incorreta</option></select><br><br><textarea id="qComment" placeholder="Comentário" style="width:100%"></textarea><br><br><select id="qBlock"></select><br><br><button onclick="saveQuestion()">Salvar</button></section><script>const supabaseClient=supabase.createClient("https://nqhthypeljupfftlmwsz.supabase.co","sb_publishable_Nzfhcwd_mFYlzJro3318-g_aX6vGjD1");let blocksMap={};function toggleNav(){document.getElementById("mainNav").style.display=document.getElementById("mainNav").style.display==="none"?"flex":"none"}function showTab(id){document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));document.getElementById(id).classList.add("active")}async function loadBlocks(){let{data,error}=await supabaseClient.from("blocos").select("*");if(error){console.error(error);return}blocksMap={};let sel=document.getElementById("filterTopics");let sel2=document.getElementById("qBlock");sel.innerHTML="<option value=''>Todos</option>";sel2.innerHTML="";data.forEach(b=>{blocksMap[b.id]=b.nome;sel.innerHTML+=`<option value="${b.id}">${b.nome}</option>`;sel2.innerHTML+=`<option value="${b.id}">${b.nome}</option>`})}async function loadQuestions(filter=""){let q=supabaseClient.from("questoes").select("*");if(filter)q=q.eq("bloco_id",filter);let{data,error}=await q;if(error){console.error(error);return}let div=document.getElementById("questionsList");div.innerHTML="<table><tr><th>Enunciado</th><th>Comentário</th><th>Correta</th><th>Bloco</th></tr>"+data.map(r=>`<tr><td>${r.enunciado}</td><td>${r.comentario||""}</td><td>${r.correta?"✔":"✘"}</td><td>${blocksMap[r.bloco_id]||"[unknown]"}</td></tr>`).join("")+"</table>"}document.getElementById("filterTopics").addEventListener("change",e=>loadQuestions(e.target.value));async function addBlock(){try{let raw=document.getElementById("blockJson").value.trim();let parsed=eval(raw);if(!Array.isArray(parsed))parsed=[parsed];let{data:block,error:blockErr}=await supabaseClient.from("blocos").insert([{nome:"Novo Bloco"}]).select();if(blockErr)throw blockErr;let bid=block[0].id;for(let q of parsed){await supabaseClient.from("questoes").insert([{enunciado:q.q,correta:q.a,comentario:q.c,bloco_id:bid}])}alert("Bloco e questões inseridos!");loadBlocks();loadQuestions()}catch(e){console.error(e);alert("Erro ao inserir bloco")}}async function loadUsers(){let{data,error}=await supabaseClient.from("usuarios").select("id,nome,tipo");if(error){console.error(error);return}let div=document.getElementById("usersList");div.innerHTML="<table><tr><th>Nome</th><th>Tipo</th><th>Ações</th></tr>"+data.map(u=>`<tr><td>${u.nome}</td><td>${u.tipo}</td><td><button onclick="revokeUser('${u.id}')">Revogar</button></td></tr>`).join("")+"</table>"}async function addUserPrompt(){let nome=prompt("Nome do usuário:");if(!nome)return;let tipo=prompt("Tipo (ex: full):");if(!tipo)return;let{error}=await supabaseClient.from("usuarios").insert([{nome,tipo}]);if(error)alert("Erro");else loadUsers()}async function revokeUser(id){await supabaseClient.from("usuarios").delete().eq("id",id);loadUsers()}async function saveQuestion(){let en=document.getElementById("qText").value.trim();if(!en){alert("Digite enunciado");return}let cor=document.getElementById("qCorrect").value==="true";let com=document.getElementById("qComment").value.trim();let bid=document.getElementById("qBlock").value;if(!bid){alert("Selecione bloco");return}let{data:exists}=await supabaseClient.from("questoes").select("id").eq("enunciado",en);if(exists.length){alert("Questão já existe");return}let{error}=await supabaseClient.from("questoes").insert([{enunciado:en,correta:cor,comentario:com,bloco_id:bid}]);if(error){alert("Erro ao salvar");return}alert("Questão salva!");document.getElementById("qText").value="";document.getElementById("qComment").value=""}window.onload=()=>{loadBlocks();loadQuestions();loadUsers()};</script></body></html>
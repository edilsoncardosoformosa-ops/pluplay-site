<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Master Admin</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f9;margin:0;padding:0}
    header{background:#1E90FF;color:#fff;padding:10px;text-align:center}
    h1{margin:0}
    #status{padding:8px;text-align:center;background:#ffdddd;color:#a00;font-weight:bold}
    #status.full{background:#ddffdd;color:#080}
    .container{padding:20px}
    .question{background:#fff;margin:10px 0;padding:10px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
    .question strong{display:block;margin-bottom:5px}
    button{margin-top:8px;padding:6px 12px;border:none;border-radius:6px;cursor:pointer}
    .true{background:#4CAF50;color:#fff}
    .false{background:#f44336;color:#fff}
  </style>
</head>
<body>
  <header>
    <h1>Painel Master</h1>
  </header>
  <div id="status">Modo Demo: até 5 questões</div>
  <div class="container">
    <div id="questionsList"></div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = "https://nqhthypeljupfftlmw sz.supabase.co".replace(" ","");
    const supabaseKey = "sb_publishable_Nzfhcwd_mFYlzJro3318-g_aX6vGjD1";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    let userId = localStorage.getItem("userId");
    if(!userId){
      userId = crypto.randomUUID();
      localStorage.setItem("userId", userId);
    }

    async function checkUserAccess(){
      try{
        const { data, error } = await supabaseClient
          .from("usuarios")
          .select("id")
          .eq("tipo", userId)
          .limit(1);

        if(error) throw error;

        if(data && data.length > 0){
          document.getElementById("status").textContent = "Acesso Full: todas as questões liberadas";
          document.getElementById("status").classList.add("full");
          return true;
        } else {
          return false;
        }
      }catch(err){
        console.error("Erro supabase checkUserAccess:", err);
        return false;
      }
    }

    async function loadQuestions(){
      try{
        const isFull = await checkUserAccess();

        let query = supabaseClient
          .from("questoes")
          .select("id, bloco_id, enunciado, correta, comentario");

        if(!isFull){
          query = query.limit(5);
        }

        const { data, error } = await query;

        if(error) throw error;

        renderQuestions(data);
      }catch(err){
        console.error("Erro supabase loadQuestions:", err);
      }
    }

    function renderQuestions(questions){
      const container = document.getElementById("questionsList");
      container.innerHTML = "";

      questions.forEach(q=>{
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `
          <strong>${q.enunciado}</strong>
          <button class="true">Verdadeiro</button>
          <button class="false">Falso</button>
        `;
        container.appendChild(div);

        const btns = div.querySelectorAll("button");
        btns.forEach(btn=>{
          btn.onclick = ()=>{
            if((btn.classList.contains("true") && q.correta) ||
               (btn.classList.contains("false") && !q.correta)){
              alert("Correto! " + (q.comentario||""));
            }else{
              alert("Incorreto! " + (q.comentario||""));
            }
          }
        });
      });
    }

    loadQuestions();
  </script>
</body>
</html>
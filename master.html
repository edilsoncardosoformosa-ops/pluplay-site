<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Master Admin</title>
<style>
:root{--p:#1E90FF;--s:#FFA500;--bg:#f4f4f9;--fg:#333}
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:var(--fg)}
header{background:var(--p);color:#fff;padding:12px 20px;display:flex;align-items:center;justify-content:space-between}
header img{height:44px}
main{padding:20px}
.card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin-bottom:16px}
button{cursor:pointer;border:0;border-radius:8px;padding:8px 12px;background:var(--p);color:#fff}
button.ghost{background:#eee;color:#222}
.grid{display:grid;gap:12px}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
input,textarea,select{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px}
label{font-weight:600}
.muted{color:#666;font-size:.95rem}
.pill{display:inline-block;padding:4px 8px;background:#eef2ff;border-radius:999px;color:#2563eb}
.hidden{display:none!important}
@media(max-width:720px){header{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>
<header id="masterHeader">
  <img src="logomarca.png" alt="Logo Plug & Play">
  <span class="muted">Master Admin</span>
</header>

<main>
<div id="appControls">
  <button id="btnAddQ">âž• Adicionar QuestÃ£o</button>
  <button id="btnAddBlock">âž• Adicionar Bloco</button>
  <button id="btnManageUsers">ðŸ‘¤ Gerenciar UsuÃ¡rios</button>
  <button id="btnManageQs">ðŸ“‹ Gerenciar QuestÃµes</button>
</div>

<!-- FormulÃ¡rios e Cards permanecem iguais, preservando layout -->

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    const SUPABASE_URL = 'https://nqhthypeljupfftlmwsz.supabase.co';
    const SUPABASE_KEY = 'sua_chave_publica';
    const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // FunÃ§Ãµes para mostrar/ocultar formulÃ¡rios
    const hideAddQuestion = ()=>document.getElementById('addQuestionForm')?.classList.add('hidden');
    const hideAddBlock = ()=>document.getElementById('addQuestionBlockForm')?.classList.add('hidden');
    const hideManageUsers = ()=>document.getElementById('manageUsers')?.classList.add('hidden');
    const hideManageQuestions = ()=>document.getElementById('manageQuestions')?.classList.add('hidden');
    const hideEditModal = ()=>document.getElementById('editQuestionModal')?.classList.add('hidden');

    document.getElementById('btnAddQ')?.addEventListener('click', ()=>document.getElementById('addQuestionForm').classList.remove('hidden'));
    document.getElementById('btnAddBlock')?.addEventListener('click', ()=>document.getElementById('addQuestionBlockForm').classList.remove('hidden'));
    document.getElementById('btnManageUsers')?.addEventListener('click', ()=>{document.getElementById('manageUsers').classList.remove('hidden'); renderUserList();});
    document.getElementById('btnManageQs')?.addEventListener('click', ()=>{document.getElementById('manageQuestions').classList.remove('hidden'); renderQuestionsList();});

    // FunÃ§Ã£o de renderizaÃ§Ã£o de usuÃ¡rios
    async function renderUserList(){
      let ul = document.getElementById('userList'); if(!ul) return; ul.innerHTML = '';
      const { data: users, error } = await supabase.from('usuarios').select();
      if(error){ console.warn('Erro ao carregar usuÃ¡rios', error); return; }
      users.forEach(u=>{
        let li = document.createElement('li');
        li.textContent=`${u.id} - ${u.nome}`;
        let btnDel = document.createElement('button');
        btnDel.textContent='Revogar'; btnDel.className='ghost'; btnDel.style.marginLeft='6px';
        btnDel.onclick = async ()=>{
          if(confirm('Revogar usuÃ¡rio?')){
            await supabase.from('usuarios').delete().eq('id', u.id);
            renderUserList();
          }
        };
        li.appendChild(btnDel); ul.appendChild(li);
      });
    }

    // FunÃ§Ã£o de renderizaÃ§Ã£o de questÃµes
    async function renderQuestionsList(){
      let container = document.getElementById('questionsList'); if(!container) return; container.innerHTML='';
      const search = (document.getElementById('searchQuestion')?.value||'').toLowerCase();
      const filterTopic = document.getElementById('filterTopic')?.value||'';
      const { data: questoes, error } = await supabase.from('questoes').select();
      if(error){ console.warn('Erro ao carregar questÃµes', error); return; }
      questoes.forEach(qObj=>{
        if(filterTopic && qObj.bloco_id!==filterTopic) return;
        if(search && !qObj.enunciado.toLowerCase().includes(search) && !(qObj.comentario||'').toLowerCase().includes(search)) return;
        let row = document.createElement('div'); row.className='row';
        let left = document.createElement('div'); left.textContent=qObj.enunciado;
        let right = document.createElement('div'); right.textContent=qObj.correta?'âœ”':'âœ–';
        row.appendChild(left); row.appendChild(right); container.appendChild(row);
      });
    }

    document.getElementById('searchQuestion')?.addEventListener('input', renderQuestionsList);
    document.getElementById('filterTopic')?.addEventListener('change', renderQuestionsList);

    renderUserList();
    renderQuestionsList();
  } catch(e){ console.error('Erro geral na inicializaÃ§Ã£o do Master', e); }
});
</script>
</main>
</body>
</html>
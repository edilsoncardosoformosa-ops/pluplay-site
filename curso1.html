<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treinamento Professor SEDF</title>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:16px;text-align:center;background:#f4f4f9;color:#333}
button{margin:4px;padding:10px 20px;font-size:1em;border-radius:10px;cursor:pointer}
button.primary{background:#2563eb;color:#fff;border:none}
button.ghost{background:#eee;border:1px solid #ccc}
button.ok{background:#16a34a;color:#fff;border:none}
button.danger{background:#dc2626;color:#fff;border:none}
button.whatsapp{background:#25d366;color:#fff;border:none}
#quiz,#result,#protectedContent{display:none;margin-top:12px}
input,textarea,select{padding:6px;border-radius:6px;border:1px solid #ddd;margin-top:4px}
input.short{width:150px;text-align:center}
textarea{width:90%}
.pill{display:inline-block;padding:2px 6px;background:#eef2ff;border-radius:999px;color:#2563eb;margin:4px}
.muted{color:#666;font-size:0.85em}
.row{display:flex;flex-wrap:wrap;justify-content:center;gap:6px}
.card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,.06);margin-bottom:12px}
.correct{color:#16a34a;font-weight:bold}
.incorrect{color:#dc2626;font-weight:bold}
#fullNote{display:none;font-size:0.9em;margin-top:6px;color:#065f46;padding:4px;background:#d1fae5;border-radius:6px}
</style>
</head>
<body>

<div id="protectedContent" class="card">
<h2>Treinamento Professor SEDF</h2>
<button id="toggleVoice" class="ghost">ðŸ”Š Ativar Ler</button>

<div id="userInfo" class="card">
<label>ID do dispositivo</label>
<div class="row">
<input id="userIdBox" readonly class="short"/>
<button id="copyIdBtn" class="ghost">ðŸ“‹ Copiar</button>
</div>
<label>Contato Master (WhatsApp)</label>
<div class="row">
<a id="waLink" target="_blank" class="whatsapp" style="text-decoration:none;padding:8px 12px;border-radius:8px">ðŸ“± Abrir WhatsApp</a>
</div>
<div style="margin-top:6px;">
<button onclick="enterPassword()" class="primary">ðŸ”‘ Inserir Senha</button>
</div>
<div class="muted">Envie seu ID para liberaÃ§Ã£o. Ao ser liberado via Master, esta seÃ§Ã£o some.</div>
</div>

<div id="menu" class="card">
<label for="numQuestions">Quantas questÃµes?</label>
<input type="number" id="numQuestions" min="1" value="10" class="short">
<div class="row" style="margin-top:8px;flex-wrap:wrap">
<button onclick="startQuiz('Lport')" class="primary">LÃ­ngua Portuguesa</button>
<button onclick="startQuiz('ride')" class="primary">RIDE</button>
<button onclick="startQuiz('Legisla')" class="primary">LegislaÃ§Ã£o</button>
<button onclick="startQuiz('TemaEdu')" class="primary">Temas Educacionais</button>
<button onclick="startQuiz('Eduincl')" class="primary">EducaÃ§Ã£o Inclusiva</button>
</div>
<div id="demoNote" class="muted hidden">ðŸ”’ Modo demo: atÃ© 5 questÃµes por tÃ³pico.</div>
<div id="fullNote"></div>
</div>
</div>

<div id="quiz" class="card">
<div id="counter" class="pill"></div>
<div id="question" style="margin:8px 0;font-weight:bold"></div>
<div class="row">
<button id="btnTrue" onclick="answer(true)" class="ok">Certo</button>
<button id="btnFalse" onclick="answer(false)" class="danger">Errado</button>
</div>
<div id="comment" class="muted" style="margin-top:6px"></div>
<div class="row" style="margin-top:8px">
<button onclick="nextQuestion()" class="primary">PrÃ³xima</button>
<button onclick="backToMenu()" class="ghost">Menu</button>
</div>
</div>

<div id="result" class="card">
<h3>Fim do Quiz!</h3>
<p id="score"></p>
<button onclick="restartQuiz()" class="primary">Reiniciar</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ---------- UsuÃ¡rio ----------
let userType = localStorage.getItem('userType')||'demo';
let userId = localStorage.getItem('userId')||crypto.randomUUID();
localStorage.setItem('userId',userId);
document.getElementById('userIdBox').value=userId;
document.getElementById('waLink').href='https://wa.me/5561999251102?text=Meu%20ID:%20'+encodeURIComponent(userId);

document.getElementById('copyIdBtn').addEventListener('click',()=>{navigator.clipboard.writeText(userId).then(()=>alert('ID copiado!'));});

function enterPassword(){
let senha=prompt("Digite a senha fornecida pelo Master:");
if(senha==="12345"){userType="full";localStorage.setItem("userType","full");alert("Acesso liberado!");document.getElementById("protectedContent").style.display="none";updateAccessUI();}
else alert("Senha incorreta.");
}

function updateAccessUI(){
if(userType==='demo'){document.getElementById('demoNote').classList.remove('hidden');document.getElementById('fullNote').style.display='none';}
else{document.getElementById('demoNote').classList.add('hidden');const f=document.getElementById('fullNote');f.style.display='block';f.innerText="âœ… Acesso total liberado! Todas as questÃµes disponÃ­veis.";}
}
if(userType!=='master'){document.getElementById('protectedContent').style.display='block';updateAccessUI();}

// ---------- Voz ----------
let voiceEnabled=false;
document.getElementById('toggleVoice').onclick=()=>{voiceEnabled=!voiceEnabled;document.getElementById('toggleVoice').innerText=voiceEnabled?'ðŸ”‡ Desativar Ler':'ðŸ”Š Ativar Ler';}

// ---------- Quiz ----------
let quizCurrent=[],currentIndex=0,score=0,answered=false;
const maxDemo=5;
function shuffleArray(a){return a.sort(()=>Math.random()-0.5);}
function startQuiz(topic){let n=parseInt(document.getElementById('numQuestions').value)||10;quizCurrent=window.quizData[topic]||[];if(userType==='demo')quizCurrent=quizCurrent.slice(0,maxDemo);quizCurrent=shuffleArray(quizCurrent).slice(0,n);currentIndex=0;score=0;showQuestion();}
function showQuestion(){if(currentIndex>=quizCurrent.length){endQuiz();return}const q=quizCurrent[currentIndex];answered=false;document.getElementById('quiz').style.display='block';document.getElementById('question').innerText=q.q;document.getElementById('comment').innerText='';document.getElementById('counter').innerText=`QuestÃ£o ${currentIndex+1} de ${quizCurrent.length}`;if(voiceEnabled){let u=new SpeechSynthesisUtterance(q.q);u.lang='pt-BR';u.rate=1.5;window.speechSynthesis.cancel();window.speechSynthesis.speak(u);}}
function answer(val){if(answered)return;answered=true;const q=quizCurrent[currentIndex];let acertou=q.a===val;document.getElementById('comment').innerHTML=`<span class="${acertou?'correct':'incorrect'}">${acertou?'VocÃª acertou!':'VocÃª errou!'} ${q.c}</span>`;if(acertou)score++;if(voiceEnabled){let u=new SpeechSynthesisUtterance((acertou?'VocÃª acertou! ':'VocÃª errou! ')+q.c);u.lang='pt-BR';u.rate=1.5;window.speechSynthesis.cancel();window.speechSynthesis.speak(u);}}
function nextQuestion(){currentIndex++;showQuestion();}
function backToMenu(){document.getElementById('quiz').style.display='none';document.getElementById('result').style.display='none';}
function endQuiz(){document.getElementById('quiz').style.display='none';document.getElementById('result').style.display='block';document.getElementById('score').innerText=`VocÃª acertou ${score} de ${quizCurrent.length} questÃµes.`;}
function restartQuiz(){currentIndex=0;score=0;document.getElementById('result').style.display='none';}

// ---------- Supabase ----------
const SUPABASE_URL="https://nqhthypeljupfftlmwsz.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xaHRoeXBlbGp1cGZmdGxtd3N6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2ODIwNzcsImV4cCI6MjA3MzI1ODA3N30.4JcgkPqt-yMrLCNdP65nQL99xyhDs2DrgR-C-CrT4z4";
const supabase=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
const blocoUuidToKey={'11111111-1111-1111-1111-111111111111':'Lport','22222222-2222-2222-2222-222222222222':'ride','33333333-3333-3333-3333-333333333333':'Legisla','44444444-4444-4444-4444-444444444444':'TemaEdu','55555555-5555-5555-5555-555555555555':'Eduincl'};
window.quizData={};

async function loadQuestions(){
try{
const {data,error}=await supabase.from('questoes').select('id,bloco_id,enunciado,correta,comentario');
if(error){console.error('Supabase error:',error);alert('Erro ao carregar questÃµes. Veja console.');return;}
if(!data||data.length===0){Object.values(blocoUuidToKey).forEach(k=>window.quizData[k]=[]);return;}
data.forEach(item=>{const t=blocoUuidToKey[item.bloco_id]||item.bloco_id||'unknown';if(!window.quizData[t])window.quizData[t]=[];window.quizData[t].push({q:item.enunciado,a:item.correta,c:item.comentario});});
console.log('QuestÃµes carregadas:',window.quizData);
}catch(e){console.error('Erro inesperado:',e);}
}
loadQuestions();
</script>
</body>
</html>
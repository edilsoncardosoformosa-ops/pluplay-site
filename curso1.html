<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Curso 1 - Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; background: #f4f4f9; color: #333; }
    button { margin: 5px; padding: 10px 20px; font-size: 1em; border-radius: 10px; cursor: pointer; }
    #quiz, #result, #menu { display: none; }
    #comment { font-size: 1.2em; color: #333; margin-top: 20px; }
    .card { background: #fff; border-radius: 10px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.06); margin-bottom: 16px; }
    .pill { display:inline-block; padding:4px 8px; background:#eef2ff; border-radius:999px; color:#2563eb; text-decoration: none; }
    input[type=number] { font-size: 1.5em; padding: 5px; width: 80px; text-align: center; }
  </style>
</head>
<body>
<div id="protectedContent" class="card">
  <h1>Treinamento Professor Tempor√°rio SEDF - P√≥s Edital</h1>
  <button id="toggleVoice">üîä Ativar Ler</button>

  <div id="menu">
    <h2>Escolha o T√≥pico</h2>
    <label for="numQuestions">Quantas Quest√µes?</label><br>
    <input type="number" id="numQuestions" min="1" max="50" value="10"><br><br>
    <button onclick="startQuiz('Lport')">L√≠ngua Portuguesa</button>
    <button onclick="startQuiz('ride')">RIDE</button>
    <button onclick="startQuiz('Legisla')">Legisla√ß√£o</button>
    <button onclick="startQuiz('TemaEdu')">Temas Educacionais</button>
    <button onclick="startQuiz('Eduincl')">Educa√ß√£o Inclusiva</button>
    <br><br>
    <div id="demoNote" style="margin-top:10px;color:#666">Demo: at√© 5 quest√µes por t√≥pico se n√£o liberado.</div>
  </div>
</div>

<div id="quiz" class="card">
  <p id="counter"></p>
  <p id="question"></p>
  <button onclick="answer(true)">Certo</button>
  <button onclick="answer(false)">Errado</button>
  <div id="comment"></div>
  <button onclick="nextQuestion()">Pr√≥xima quest√£o</button>
  <button onclick="backToMenu()">Voltar ao Menu</button>
</div>

<div id="result" class="card">
  <h2>Fim do Quiz!</h2>
  <p id="score"></p>
  <button onclick="restartQuiz()">Reiniciar</button>
</div>

<div id="userInfo" class="card" style="margin-top:15px">
  <p>ID do seu dispositivo: <span id="userId"></span></p>
  <button id="copyIdBtn">üìã Copiar ID</button>
  <p>Para liberar acesso completo, envie este ID via WhatsApp:</p>
  <a id="waLink" href="#" target="_blank" class="pill">Contato Master +55(61)99925-1102</a>
</div>

<!-- Quiz.js atualizado -->
<script>
  // Gera ou pega userId
  let userId = localStorage.getItem("userId");
  if(!userId){ userId = crypto.randomUUID(); localStorage.setItem("userId", userId); }

  // Exibe userId
  document.getElementById("userId").textContent = userId;
  document.getElementById("waLink").href = 'https://wa.me/5561999251102?text=Meu%20ID:%20'+encodeURIComponent(userId);

  document.getElementById("copyIdBtn").addEventListener("click",()=>{
    const text = userId;
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(()=>alert("ID copiado!")).catch(()=>fallbackCopy(text));
    } else { fallbackCopy(text); }
  });

  function fallbackCopy(t){
    const a=document.createElement("textarea");
    a.value=t; document.body.appendChild(a); a.select();
    try{ document.execCommand('copy')?alert("ID copiado!"):alert("N√£o foi poss√≠vel copiar, selecione manualmente.") }
    catch(e){ alert("Erro ao copiar, selecione manualmente."); }
    document.body.removeChild(a);
  }

  // Controle de voz
  let voiceEnabled=false;
  document.getElementById("toggleVoice").addEventListener("click",()=>{
    voiceEnabled=!voiceEnabled;
    document.getElementById("toggleVoice").textContent = voiceEnabled?"üîâ Desativar Ler":"üîä Ativar Ler";
  });

  // Quiz variables
  let currentQuestions=[], currentIndex=0, score=0;

  // Carrega controle.js com versionamento
  function loadQuizData(callback){
    fetch("version.txt")
      .then(r=>r.text())
      .then(version=>{
        var s=document.createElement("script");
        s.src="controle.js?v="+version.trim();
        s.onload=callback; document.head.appendChild(s);
      })
      .catch(()=>{
        var s=document.createElement("script");
        s.src="controle.js?v="+new Date().getTime();
        s.onload=callback; document.head.appendChild(s);
      });
  }

  // Fun√ß√µes do quiz (global)
  loadQuizData(()=>{
    window.startQuiz = function(topic){
      let all=window.quizData[topic]||[];
      if(!all.length){ alert("Sem quest√µes neste t√≥pico."); return; }
      const allowed=false; // pode integrar allowedUsers depois
      if(!allowed) all=all.slice(0,5);
      const num=parseInt(document.getElementById("numQuestions").value)||10;
      currentQuestions=all.slice(0,num); currentIndex=0; score=0;
      document.getElementById("menu").style.display="none";
      document.getElementById("quiz").style.display="block";
      showQuestion();
    };

    window.showQuestion = function(){
      if(currentIndex>=currentQuestions.length){ endQuiz(); return; }
      const q=currentQuestions[currentIndex];
      document.getElementById("question").textContent=q.q;
      document.getElementById("comment").textContent="";
      document.getElementById("counter").textContent=`Quest√£o ${currentIndex+1} de ${currentQuestions.length}`;
      if(voiceEnabled){ let u=new SpeechSynthesisUtterance(q.q); u.lang="pt-BR"; u.rate=1.5; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); }
    };

    window.answer=function(choice){
      const q=currentQuestions[currentIndex];
      const txt=(choice===q.a?"‚úì Correto! ":"‚úó Errado! ")+(q.c||"");
      document.getElementById("comment").textContent=txt;
      if(choice===q.a) score++;
      if(voiceEnabled){ let u=new SpeechSynthesisUtterance(txt); u.lang="pt-BR"; u.rate=1.2; window.speechSynthesis.speak(u); }
    };

    window.nextQuestion=function(){ currentIndex++; showQuestion(); };
    window.backToMenu=function(){ document.getElementById("quiz").style.display="none"; document.getElementById("result").style.display="none"; document.getElementById("menu").style.display="block"; };
    window.endQuiz=function(){ document.getElementById("quiz").style.display="none"; document.getElementById("result").style.display="block"; document.getElementById("score").textContent=`Voc√™ acertou ${score} de ${currentQuestions.length}`; };
    window.restartQuiz=function(){ document.getElementById("result").style.display="none"; document.getElementById("menu").style.display="block"; };
  });
</script>
</body>
</html>
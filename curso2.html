<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Treinamento Professor Tempor√°rio SEDF ‚Äî P√≥s-Edital</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  :root {
    --bg:#f7f7fb; --fg:#111; --muted:#555; --card:#fff; --accent:#2563eb;
    --ok:#16a34a; --err:#dc2626; --shadow: 0 8px 24px rgba(0,0,0,.08);
    --radius:14px; --btn-padding:14px 20px; --btn-font:1.05em;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;height:100%; width:100%;}
  .wrap{max-width:980px;margin:16px auto;padding:0 16px;}
  h1{font-size:clamp(24px,3vw,30px);margin:0 0 12px;cursor:pointer}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px; width:100%;}
  .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  .row > * {flex:0 0 auto}
  button{border:0;background:#eee;border-radius:12px;padding:var(--btn-padding);cursor:pointer;font-size:var(--btn-font);}
  button.primary{background:var(--accent);color:#fff}
  button.ghost{background:transparent;border:1px solid #ddd}
  button.danger{background:var(--err);color:#fff}
  button.ok{background:var(--ok);color:#fff}
  button:disabled{opacity:.5;cursor:not-allowed}
  input,select,textarea{
    border:1px solid #ddd;border-radius:10px;padding:10px 12px;
    font-size:14px; outline:0; background:#fff; width:100%;
  }
  label{font-weight:600;font-size:13px;color:var(--muted)}
  .grid{display:grid;gap:12px}
  .two{grid-template-columns:repeat(2,minmax(0,1fr))}
  .three{grid-template-columns:repeat(3,minmax(0,1fr))}
  @media (max-width:720px){ .two,.three{grid-template-columns:1fr} }
  .muted{color:var(--muted)}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:#eef2ff;color:#3b82f6;border:1px solid #dbeafe}
  .hidden{display:none!important}
  .section-title{margin:18px 0 8px;font-size:15px;font-weight:700}
  #comment{font-size:16px;margin-top:10px}
  #question{font-size:18px}
  .space{height:8px}
</style>
</head>
<body>
<div class="wrap">

  <!-- Cabe√ßalho -->
  <div class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <div>
        <h1 id="trainingTitle">Treinamento Professor Tempor√°rio SEDF ‚Äî P√≥s-Edital</h1>
        <div class="muted">Quiz protegido com modos: Master, Aluno e Demo</div>
      </div>
      <div class="row">
        <button id="toggleVoice" class="ghost">üîä Ativar Ler</button>
        <button id="btnManage" class="ghost hidden">üõ†Ô∏è Gerenciar</button>
      </div>
    </div>
  </div>

  <div class="space"></div>

  <!-- Conte√∫do protegido -->
  <div id="protectedContent" class="card hidden">

    <!-- Info usu√°rio/demo -->
    <div id="userInfo" class="hidden">
      <div class="section-title">Acesso do Aluno / Demo</div>
      <div class="grid two">
        <div>
          <label>ID do seu dispositivo</label>
          <div class="row">
            <input id="userIdBox" readonly />
            <button id="copyIdBtn">üìã Copiar</button>
          </div>
        </div>
        <div>
          <label>Contato do Master (WhatsApp)</label>
          <div class="row">
            <a id="waLink" class="primary" target="_blank" style="text-decoration:none;display:inline-block;padding:10px 14px;border-radius:10px">
              Abrir WhatsApp do Master
            </a>
            <span class="pill">+55 (61) 99925-1102</span>
          </div>
          <div class="muted" style="margin-top:6px">
            Envie seu ID ao Master para solicitar libera√ß√£o. Ao ser liberado via senha de aluno, esta se√ß√£o some automaticamente.
          </div>
        </div>
      </div>
    </div>
<!-- Menu de t√≥picos e a√ß√µes -->
    <div id="menu" class="grid two" style="margin-top:16px">
      <div>
        <div class="section-title">Escolha o T√≥pico</div>
        <label for="numQuestions">Quantas quest√µes?</label>
        <input type="number" id="numQuestions" min="1" max="><" value="10" />
        <div class="row" style="margin-top:10px;flex-wrap:wrap">
          <button onclick="startQuiz('Lport')" class="primary">L√≠ngua Portuguesa</button>
          <button onclick="startQuiz('ride')" class="primary">RIDE</button>
          <button onclick="startQuiz('Legisla')" class="primary">Legisla√ß√£o</button>
          <button onclick="startQuiz('TemaEdu')" class="primary">Temas Educacionais</button>
          <button onclick="startQuiz('Eduincl')" class="primary">Educa√ß√£o Inclusiva</button>
        </div>
        <div id="demoNote" class="muted hidden" style="margin-top:8px">
          üîí Modo demo ativo: at√© <b>5 quest√µes por t√≥pico</b>.
        </div>
      </div>

      <!-- Bot√µes Master -->
      <div id="adminButtons" class="hidden">
        <div class="section-title">A√ß√µes do Master</div>
        <div class="grid">
          <button onclick="showAddQuestion()" class="ok">‚ûï Adicionar quest√£o</button>
          <button onclick="showAddBlock()" class="ok">‚ûï Adicionar bloco</button>
        </div>
      </div>
    </div>

    <!-- Quiz -->
    <div id="quiz" class="hidden" style="margin-top:16px">
      <div class="row" style="justify-content:space-between">
        <div id="counter" class="pill"></div>
        <button onclick="backToMenu()" class="ghost">‚Ü©Ô∏è Voltar ao menu</button>
      </div>
      <div style="margin-top:10px">
        <div id="question"></div>
        <div class="row" style="margin-top:12px">
          <button id="btnTrue" onclick="answer(true)" class="ok">Certo</button>
          <button id="btnFalse" onclick="answer(false)" class="danger">Errado</button>
        </div>
        <div id="comment" class="muted"></div>
        <div class="row" style="margin-top:12px">
          <button onclick="nextQuestion()" class="primary">Pr√≥xima quest√£o</button>
        </div>
      </div>
    </div>

    <!-- Resultados -->
    <div id="result" class="hidden" style="margin-top:16px">
      <h3>Fim do Quiz!</h3>
      <p id="score"></p>
      <button onclick="restartQuiz()" class="primary">Reiniciar</button>
    </div>

    <!-- Formul√°rios Master -->
    <div id="addQuestionForm" class="hidden" style="margin-top:16px">
      <div class="section-title">Adicionar nova quest√£o</div>
      <div class="grid two">
        <div>
          <label>T√≥pico</label>
          <select id="newTopic">
            <option value="Lport">L√≠ngua Portuguesa</option>
            <option value="ride">RIDE</option>
            <option value="Legisla">Legisla√ß√£o</option>
            <option value="TemaEdu">Temas Educacionais</option>
            <option value="Eduincl">Educa√ß√£o Inclusiva</option>
          </select>
        </div>
        <div>
          <label>Resposta correta?</label>
          <select id="newQuestionAnswer">
            <option value="true">Certo</option>
            <option value="false">Errado</option>
          </select>
        </div>
      </div>
      <div class="grid" style="margin-top:8px">
        <div>
          <label>Pergunta</label>
          <textarea id="newQuestionText" rows="3"></textarea>
        </div>
        <div>
          <label>Coment√°rio</label>
          <textarea id="newQuestionComment" rows="3"></textarea>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <button onclick="addQuestion()" class="ok">Adicionar</button>
        <button onclick="hideAddQuestion()" class="ghost">Cancelar</button>
      </div>
    </div>

    <div id="addQuestionBlockForm" class="hidden" style="margin-top:16px">
      <div class="section-title">Adicionar bloco de quest√µes</div>
      <div class="grid two">
        <div>
          <label>T√≥pico</label>
          <select id="newBlockTopic">
            <option value="Lport">L√≠ngua Portuguesa</option>
            <option value="ride">RIDE</option>
            <option value="Legisla">Legisla√ß√£o</option>
            <option value="TemaEdu">Temas Educacionais</option>
            <option value="Eduincl">Educa√ß√£o Inclusiva</option>
          </select>
        </div>
        <div>
          <label>Formato</label>
          <div class="muted" style="font-size:12px">
            {q: 'Pergunta', a: true|false, c: 'Coment√°rio'}, ... (uma por linha)
          </div>
        </div>
      </div>
      <div style="margin-top:8px">
        <textarea id="newBlockQuestions" rows="6" placeholder="{q: 'Pergunta 1', a: true,  c: 'Coment√°rio 1'},&#10;{q: 'Pergunta 2', a: false, c: 'Coment√°rio 2'}"></textarea>
      </div>
      <div class="row" style="margin-top:8px">
        <button onclick="addQuestionBlock()" class="ok">Adicionar bloco</button>
        <button onclick="hideAddBlock()" class="ghost">Cancelar</button>
      </div>
    </div>

  </div> <!-- /wrap -->

<script src="controle.js"></script>
<script>
// ==== Inicializa√ß√£o ====
let userType = localStorage.getItem('userType') || 'demo';
let userId = localStorage.getItem('userId') || crypto.randomUUID();
localStorage.setItem('userId', userId);

// Preencher ID e WhatsApp
document.getElementById('userIdBox').value = userId;
document.getElementById('waLink').href = 'https://wa.me/5561999251102?text=Meu%20ID:%20'+encodeURIComponent(userId);
document.getElementById('copyIdBtn').addEventListener('click', () => {
  const userId = document.getElementById('userIdBox').value;
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(userId)
      .then(() => alert('ID copiado!'))
      .catch(() => fallbackCopy(userId));
  } else {
    fallbackCopy(userId);
  }
});

function fallbackCopy(text) {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  document.body.appendChild(textarea);
  textarea.select();
  try {
    document.execCommand('copy') ? alert('ID copiado!') : alert('N„o foi possÌvel copiar.');
  } catch (e) {
    alert('Erro ao copiar. Copie manualmente.');
  }
  document.body.removeChild(textarea);
}

// Mostrar conte√∫do protegido
if(userType!=='master'){
  document.getElementById('protectedContent').classList.remove('hidden');
  document.getElementById('userInfo').classList.remove('hidden');
  if(userType==='demo') document.getElementById('demoNote').classList.remove('hidden');
}else{
  document.getElementById('protectedContent').classList.remove('hidden');
  document.getElementById('adminButtons').classList.remove('hidden');
  document.getElementById('btnManage').classList.remove('hidden');
}

// ==== Voz ====
let voiceEnabled=false;
document.getElementById('toggleVoice').onclick = ()=>{
  voiceEnabled = !voiceEnabled;
  document.getElementById('toggleVoice').innerText = voiceEnabled?'üîà Desativar Ler':'üîä Ativar Ler';
};

// ==== Quiz ====
let quizCurrent=[], currentIndex=0, score=0;
const maxDemo = 5;

function shuffleArray(arr){ return arr.sort(()=>Math.random()-0.5); }

function startQuiz(topic){
  let numQ = parseInt(document.getElementById('numQuestions').value)||10;
  quizCurrent = window.quizData[topic] || [];
  if(userType==='demo') quizCurrent = quizCurrent.slice(0,maxDemo);
  quizCurrent = shuffleArray(quizCurrent).slice(0,numQ);
  currentIndex=0; score=0;
  showQuestion();
}

function showQuestion(){
  if(currentIndex>=quizCurrent.length){ endQuiz(); return; }
  const q = quizCurrent[currentIndex];
  document.getElementById('quiz').classList.remove('hidden');
  document.getElementById('result').classList.add('hidden');
  document.getElementById('question').innerText = q.q;
  document.getElementById('comment').innerText = '';
  document.getElementById('counter').innerText = `Quest√£o ${currentIndex+1} de ${quizCurrent.length}`;
  if(voiceEnabled){
    let u = new SpeechSynthesisUtterance(q.q);
    u.lang='pt-BR'; u.rate=1.5;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }
}

function answer(val){
  const q = quizCurrent[currentIndex];
  document.getElementById('comment').innerText = q.c;
  if(q.a===val) score++;
  if(voiceEnabled){
    let u = new SpeechSynthesisUtterance(q.c);
    u.lang='pt-BR'; u.rate=1.5;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }
}

function nextQuestion(){ currentIndex++; showQuestion(); }

function endQuiz(){
  document.getElementById('quiz').classList.add('hidden');
  document.getElementById('result').classList.remove('hidden');
  document.getElementById('score').innerText = `Voc√™ acertou ${score} de ${quizCurrent.length} quest√µes.`;
}

function restartQuiz(){ currentIndex=0; score=0; document.getElementById('result').classList.add('hidden'); }

// ==== Master ====
function addQuestion(){
  const topic=document.getElementById('newTopic').value;
  const q=document.getElementById('newQuestionText').value.trim();
  const c=document.getElementById('newQuestionComment').value.trim();
  const a=document.getElementById('newQuestionAnswer').value==='true';
  if(q) { window.quizData[topic].push({q,a,c}); hideAddQuestion(); alert('Quest√£o adicionada!'); }
}
function showAddQuestion(){document.getElementById('addQuestionForm').classList.remove('hidden');}
function hideAddQuestion(){document.getElementById('addQuestionForm').classList.add('hidden');}

function addQuestionBlock(){
  const topic=document.getElementById('newBlockTopic').value;
  try{
    const lines=document.getElementById('newBlockQuestions').value.split('\n').filter(l=>l.trim());
    for(const l of lines){ const obj=eval('('+l+')'); window.quizData[topic].push(obj); }
    hideAddBlock(); alert('Bloco adicionado!');
  }catch(e){alert('Erro ao adicionar bloco');}
}
function showAddBlock(){document.getElementById('addQuestionBlockForm').classList.remove('hidden');}
function hideAddBlock(){document.getElementById('addQuestionBlockForm').classList.add('hidden');}
function backToMenu(){
  document.getElementById('quiz').classList.add('hidden');
  document.getElementById('result').classList.add('hidden');
}
</script>
</body>
</html>
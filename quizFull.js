// quizFull.js
const SUPABASE_URL="https://nqhthypeljupfftlmwsz.supabase.co",SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xaHRoeXBlbGp1cGZmdGxtd3N6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2ODIwNzcsImV4cCI6MjA3MzI1ODA3N30.4JcgkPqt-yMrLCNdP65nQL99xyhDs2DrgR-C-CrT4z4",supabaseClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY),blocoUuidToKey={11111111-1111-1111-1111-111111111111:"Lport",22222222-2222-2222-2222-222222222222:"ride",33333333-3333-3333-3333-333333333333:"Legisla",44444444-4444-4444-4444-444444444444:"TemaEdu",55555555-5555-5555-5555-555555555555:"Eduincl"},maxDemo=5;window.quizData={},userType=localStorage.getItem("userType")||"demo",userId=localStorage.getItem("userId")||crypto.randomUUID();localStorage.setItem("userId",userId),document.getElementById("userIdBox").value=userId,document.getElementById("waLink").href="https://wa.me/5561999251102?text=Meu%20ID:%20"+encodeURIComponent(userId),document.getElementById("copyIdBtn").addEventListener("click",()=>{const e=document.getElementById("userIdBox").value;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>alert("ID copiado!")).catch(()=>{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("ID copiado!")})}) ,function(){let e=prompt("Digite a senha fornecida pelo Master:");"12345"===e&&(userType="full",localStorage.setItem("userType","full"),alert("Acesso liberado!"),document.getElementById("protectedContent").style.display="none")}();if(userType!=="master"){document.getElementById("protectedContent").style.display="block","demo"===userType&&document.getElementById("demoNote").classList.remove("hidden")}let voiceEnabled=!1;document.getElementById("toggleVoice").onclick=()=>{voiceEnabled=!voiceEnabled,document.getElementById("toggleVoice").innerText=voiceEnabled?"ðŸ”‡ Desativar Ler":"ðŸ”Š Ativar Ler"};let quizCurrent=[],currentIndex=0,score=0,answered=!1;function shuffleArray(e){return e.sort(()=>Math.random()-.5)}function startQuiz(e){let t=parseInt(document.getElementById("numQuestions").value)||10;quizCurrent=window.quizData[e]||[],"demo"===userType&&(quizCurrent=quizCurrent.slice(0,maxDemo)),quizCurrent=shuffleArray(quizCurrent).slice(0,t),currentIndex=0,score=0,showQuestion(),userType==="full"&&alert("Acesso liberado: vocÃª pode fazer todas as questÃµes!") }function showQuestion(){if(currentIndex>=quizCurrent.length)return endQuiz(),void 0;const e=quizCurrent[currentIndex];answered=!1,document.getElementById("quiz").style.display="block",document.getElementById("question").innerText=e.q,document.getElementById("comment").innerText="",document.getElementById("counter").innerText=`QuestÃ£o ${currentIndex+1} de ${quizCurrent.length}`,voiceEnabled&&(u=new SpeechSynthesisUtterance(e.q),u.lang="pt-BR",u.rate=1.5,window.speechSynthesis.cancel(),window.speechSynthesis.speak(u))}function answer(e){if(answered)return;answered=!0;const t=quizCurrent[currentIndex],n=t.a===e?"VocÃª acertou!":"VocÃª errou!";document.getElementById("comment").innerHTML=`<span class="${t.a===e?"correct":"incorrect"}">${n} ${t.c}</span>`,t.a===e&&score++,voiceEnabled&&(u=new SpeechSynthesisUtterance(n+" "+t.c),u.lang="pt-BR",u.rate=1.5,window.speechSynthesis.cancel(),window.speechSynthesis.speak(u))}function nextQuestion(){currentIndex++,showQuestion()}function backToMenu(){document.getElementById("quiz").style.display="none",document.getElementById("result").style.display="none"}function endQuiz(){document.getElementById("quiz").style.display="none",document.getElementById("result").style.display="block",document.getElementById("score").innerText=`VocÃª acertou ${score} de ${quizCurrent.length} questÃµes.`}function restartQuiz(){currentIndex=0,score=0,document.getElementById("result").style.display="none"}async function loadQuestions(){try{const{data:e,error:t}=await supabaseClient.from("questoes").select("id, bloco_id, enunciado, correta, comentario");t?(console.error("Supabase error:",t),alert("Erro ao carregar questÃµes. Veja console.")):e&&(e.forEach(e=>{const t=blocoUuidToKey[e.bloco_id]||e.bloco_id||"unknown";window.quizData[t]||(window.quizData[t]=[]),window.quizData[t].push({q:e.enunciado,a:e.correta,c:e.comentario})}),console.log("QuestÃµes carregadas:",window.quizData))}catch(e){console.error("Erro inesperado:",e)}}loadQuestions();